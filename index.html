<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Campionato Arena</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg,#0a2a43,#0f5132); color:#fff; margin:0; padding:0;}
header {text-align:center; padding:15px; background:linear-gradient(90deg,#008C45,#F4F5F0,#CD212A); color:#000; font-weight:bold; font-size:24px;}
main {padding:10px; max-width:480px; margin:auto;}
.tabs {display:flex; flex-wrap: wrap; border-bottom:2px solid #fff; margin-bottom:10px;}
.tab {flex:1 1 45%; text-align:center; padding:8px 5px; cursor:pointer; background:rgba(255,255,255,0.1); border-radius:10px 10px 0 0; margin:2px; font-size:14px;}
.tab.active {background:#ffc107; color:#000; font-weight:bold;}
.tabContent {display:none;}
.tabContent.active {display:block;}
.card {background:rgba(255,255,255,0.1); border-radius:12px; padding:15px; margin-bottom:15px; box-shadow:0 5px 15px rgba(0,0,0,0.3);}
input, select, button {width:100%; padding:8px; border-radius:8px; border:none; margin:4px 0; font-size:14px;}
button {background:#ffc107; cursor:pointer; font-weight:bold;}
ul {list-style:none; padding:0; font-size:14px;}
table {width:100%; border-collapse:collapse; margin-top:8px; font-size:12px;}
th, td {border:1px solid #fff; padding:4px; text-align:center;}
.highlight {background-color: rgba(255,255,0,0.3); font-weight:bold;}
footer {text-align:center; padding:10px; font-size:12px; opacity:0.7;}
.logoutBtn {margin-top:5px; background:#ff4d4d;}
.statBtn {width:30%; margin:2px auto; display:inline-block;}
</style>
</head>
<body>
<header>ğŸ† Campionato Arena</header>
<main>

<!-- LOGIN -->
<div class="card" id="loginCard">
<h2>ğŸ” Accesso</h2>
<input id="loginNome" placeholder="Inserisci il tuo nome" />
<div id="passwordDiv" style="display:none;">
  <input id="loginPassword" type="password" placeholder="Password (solo admin)" />
</div>
<br>
<button id="btnLogin">Entra</button>
<p id="loginInfo" style="margin-top:8px;opacity:0.8"></p>
</div>

<!-- APP CONTENT -->
<div id="appContent" style="display:none">
<button class="logoutBtn" id="btnLogout">ğŸšª Logout</button>

<div class="tabs">
<div class="tab active" data-tab="squadreTab">ğŸ‘¥ Squadre</div>
<div class="tab" data-tab="classificaTab">ğŸ† Classifica</div>
<div class="tab" data-tab="statTab">âš½ Marcatori & Assist</div>
<div class="tab" data-tab="calendarioTab">ğŸ“… Calendario</div>
<div class="tab" data-tab="scoreTab">ğŸ“Š Mio Score</div>
<div class="tab" data-tab="backupTab">ğŸ’¾ Backup</div>
</div>

<!-- TABS CONTENT -->
<div id="squadreTab" class="tabContent active">
<h3>Gestione Squadre</h3>
<input id="newSquadra" placeholder="Nome squadra" />
<select id="newColore">
<option value="#ff0000">Rosso</option>
<option value="#00ff00">Verde</option>
<option value="#0000ff">Blu</option>
<option value="#ffff00">Giallo</option>
<option value="#ff00ff">Fucsia</option>
<option value="#00ffff">Ciano</option>
<option value="#ffa500">Arancione</option>
<option value="#800080">Viola</option>
<option value="#008080">Teal</option>
<option value="#000000">Nero</option>
</select>
<button id="btnAddSquadra">â• Aggiungi Squadra</button>
<div id="listaSquadre"></div>
</div>

<div id="classificaTab" class="tabContent"><h3>Classifica</h3><div id="tabellaClassifica"></div></div>
<div id="statTab" class="tabContent"><h3>Marcatori & Assist</h3><div id="tabellaStats"></div></div>
<div id="calendarioTab" class="tabContent"><h3>Calendario</h3><div id="tabellaCalendario"></div></div>
<div id="scoreTab" class="tabContent"></div>
<div id="backupTab" class="tabContent"><h3>Backup Admin</h3><p>Solo per amministratori.</p></div>

</main>
<footer>Ideata da Vitlollo Â· Sviluppata con ChatGPT âš½ğŸ‡®ğŸ‡¹</footer>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
import { getFirestore, collection, doc, setDoc, getDocs, updateDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

// Config Firebase
const firebaseConfig = {
  apiKey: "INSERISCI_LA_TUA_API_KEY",
  authDomain: "campionato-arena-2026.firebaseapp.com",
  projectId: "campionato-arena-2026",
  storageBucket: "campionato-arena-2026.appspot.com",
  messagingSenderId: "844668143316",
  appId: "1:844668143316:web:c72cb60c6e3513582f5d41"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// LOGIN / LOGOUT
let loggedUser = '';
const admins = {"Vitantonio":"giulia85","Fabrizio":"manetta26","Jacopo":"forzaroma1"};

const loginNome = document.getElementById('loginNome');
const loginPassword = document.getElementById('loginPassword');
const passwordDiv = document.getElementById('passwordDiv');

loginNome.addEventListener('input', ()=>{
  if(admins[loginNome.value.trim()]) passwordDiv.style.display='block';
  else passwordDiv.style.display='none';
});

document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', ()=> {
  document.querySelectorAll('.tabContent').forEach(tc=>tc.classList.remove('active'));
  document.getElementById(tab.dataset.tab).classList.add('active');
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
}));

document.getElementById('btnLogin').addEventListener('click', async ()=>{
  const nome = loginNome.value.trim();
  const password = loginPassword.value;
  const info = document.getElementById('loginInfo');
  if(!nome){ info.innerText='Inserisci un nome valido'; return; }
  if(admins[nome] && admins[nome]!==password){ info.innerText='Password errata!'; return; }
  info.innerText='';
  loggedUser = nome;
  document.getElementById('loginCard').style.display='none';
  document.getElementById('appContent').style.display='block';
  document.querySelector(`.tab[data-tab='backupTab']`).style.display=(admins[nome]? 'block':'none');
  await mostraMioScore();
});

document.getElementById('btnLogout').addEventListener('click', ()=>{
  loggedUser='';
  document.getElementById('appContent').style.display='none';
  document.getElementById('loginCard').style.display='block';
  loginNome.value='';
  loginPassword.value='';
  passwordDiv.style.display='none';
});

// AGGIUNGI SQUADRA
document.getElementById('btnAddSquadra').addEventListener('click', async ()=>{
  const nome = document.getElementById('newSquadra').value.trim();
  const colore = document.getElementById('newColore').value;
  if(!nome){ alert('Inserisci nome squadra'); return; }
  await setDoc(doc(db,'squadre',nome), {nome,colore});
  document.getElementById('newSquadra').value='';
  alert('Squadra aggiunta!');
});

// MOSTRA MIO SCORE
async function mostraMioScore(){
  const container = document.getElementById('scoreTab');
  container.innerHTML='';
  try{
    const snapshot = await getDocs(collection(db, 'giocatori'));
    let trovato=false;
    snapshot.forEach(docSnap => {
      const g = docSnap.data();
      if(g.nome.toLowerCase()===loggedUser.toLowerCase()){
        trovato=true;
        container.innerHTML = `<h2>ğŸ“Š Statistiche di ${g.nome}</h2>
        <ul>
          <li>Ruolo: ${g.ruolo||'Calciatore'}</li>
          <li>Presenze: ${g.presenze||0} <button class="statBtn" onclick="updateStat('${docSnap.id}','presenze',1)">+</button><button class="statBtn" onclick="updateStat('${docSnap.id}','presenze',-1)">-</button></li>
          <li>Gol: ${g.gol||0} <button class="statBtn" onclick="updateStat('${docSnap.id}','gol',1)">+</button><button class="statBtn" onclick="updateStat('${docSnap.id}','gol',-1)">-</button></li>
          <li>Assist: ${g.assist||0} <button class="statBtn" onclick="updateStat('${docSnap.id}','assist',1)">+</button><button class="statBtn" onclick="updateStat('${docSnap.id}','assist',-1)">-</button></li>
          <li>Cartellini Gialli: ${g.giallo||0} <button class="statBtn" onclick="updateStat('${docSnap.id}','giallo',1)">+</button><button class="statBtn" onclick="updateStat('${docSnap.id}','giallo',-1)">-</button></li>
          <li>Cartellini Rossi: ${g.rosso||0} <button class="statBtn" onclick="updateStat('${docSnap.id}','rosso',1)">+</button><button class="statBtn" onclick="updateStat('${docSnap.id}','rosso',-1)">-</button></li>
        </ul>`;
      }
    });
    if(!trovato) container.innerHTML='<p>âš ï¸ Nessuna statistica disponibile.</p>';
  }catch(e){ container.innerHTML='<p>Errore nel caricamento delle statistiche.</p>'; }
}

// FUNZIONE AGGIORNA STATISTICHE
window.updateStat = async function(id,field,delta){
  const ref = doc(db,'giocatori',id);
  const snap = await getDocs(collection(db,'giocatori'));
  snap.forEach(async d=>{
    if(d.id===id){
      const val = d.data()[field]||0;
      const newVal = Math.max(0,val+delta);
      await updateDoc(ref,{[field]:newVal});
      await mostraMioScore();
    }
  });
}

// SERVICE WORKER PWA
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').then(()=>console.log('Service Worker registrato')).catch(e=>console.log(e));
}
</script>
</body>
</html>
